# Deploying EverythingInBot to Render.com

Complete step-by-step guide for deploying your Telegram Super-App to Render.

---

## Prerequisites

Before you begin, ensure you have:

- âœ… GitHub account
- âœ… Render.com account (free tier works)
- âœ… MongoDB Atlas account (free M0 cluster)
- âœ… Telegram Bot Token (from @BotFather)
- âœ… API keys for services you want to use (OpenAI, Claude, etc.)

---

## Step 1: Setup MongoDB Atlas

### 1.1 Create Cluster
1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a free M0 cluster
3. Choose a cloud provider and region (AWS recommended)
4. Name your cluster (e.g., "everythinginbot")

### 1.2 Create Database User
1. Go to "Database Access"
2. Click "Add New Database User"
3. Choose "Password" authentication
4. Username: `botuser` (or your choice)
5. Generate a strong password and save it
6. Grant "Read and write to any database" role

### 1.3 Configure Network Access
1. Go to "Network Access"
2. Click "Add IP Address"
3. Select "Allow Access from Anywhere" (`0.0.0.0/0`)
   - This is required for Render to connect
4. Confirm

### 1.4 Get Connection String
1. Go to "Database" â†’ "Connect"
2. Choose "Connect your application"
3. Copy the connection string
4. Replace `<password>` with your database user password
5. Replace `<dbname>` with `everythinginbot`

Example:
```
mongodb+srv://botuser:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/everythinginbot?retryWrites=true&w=majority
```

---

## Step 2: Create Telegram Bot

### 2.1 Get Bot Token
1. Open Telegram and search for `@BotFather`
2. Send `/newbot`
3. Follow prompts to name your bot
4. Save the bot token (looks like `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2.2 Configure Bot
```
/setdescription - Set bot description
/setabouttext - Set about text
/setuserpic - Upload bot profile picture
/setcommands - Set bot commands
```

Suggested commands:
```
start - Start the bot
help - Get help
profile - View your profile
upgrade - Upgrade to Pro
```

---

## Step 3: Push Code to GitHub

### 3.1 Initialize Git Repository
```bash
cd EverythingInBot
git init
git add .
git commit -m "Initial commit: EverythingInBot v1.0"
```

### 3.2 Create GitHub Repository
1. Go to [GitHub](https://github.com)
2. Click "New repository"
3. Name: `EverythingInBot`
4. Make it private (recommended)
5. Don't initialize with README (we already have one)
6. Create repository

### 3.3 Push to GitHub
```bash
git remote add origin https://github.com/YOUR_USERNAME/EverythingInBot.git
git branch -M main
git push -u origin main
```

---

## Step 4: Deploy to Render

### 4.1 Create Render Account
1. Go to [Render.com](https://render.com)
2. Sign up with GitHub (recommended)
3. Authorize Render to access your repositories

### 4.2 Deploy via Blueprint

1. Click "New" â†’ "Blueprint"
2. Connect your GitHub repository
3. Select `EverythingInBot` repository
4. Render will detect `render.yaml`
5. Click "Apply"

### 4.3 Configure Environment Variables

Render will create 3 services:
- `everythinginbot-web` (Web Service)
- `everythinginbot-worker` (Background Worker)
- `everythinginbot-redis` (Redis)

For **Web Service**, add these environment variables:

#### Required Variables
```
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
MONGODB_URI=your_mongodb_atlas_connection_string
```

#### Optional AI Services (add as needed)
```
OPENAI_API_KEY=sk-your-openai-key
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key
GOOGLE_AI_API_KEY=your-google-ai-key
```

#### Optional Breach Check
```
XPOSEDORNOT_API_KEY=your-xposedornot-key
```

#### Optional Payment Gateways
```
RAZORPAY_KEY_ID=your-razorpay-key
RAZORPAY_KEY_SECRET=your-razorpay-secret
STRIPE_API_KEY=sk_test_your-stripe-key
```

**Note**: `REDIS_URL`, `TELEGRAM_WEBHOOK_SECRET`, and `JWT_SECRET_KEY` are auto-generated by Render.

For **Worker Service**, add the same variables except webhook-related ones.

### 4.4 Deploy
1. Click "Apply" to start deployment
2. Wait for build to complete (5-10 minutes)
3. Check logs for any errors

---

## Step 5: Set Telegram Webhook

Once deployment is successful:

### 5.1 Get Your Render URL
Your web service URL will be: `https://everythinginbot-web.onrender.com`

### 5.2 Set Webhook
Open your browser and visit:
```
https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://everythinginbot-web.onrender.com/webhook/<YOUR_BOT_TOKEN>
```

Replace `<YOUR_BOT_TOKEN>` with your actual bot token.

You should see:
```json
{
  "ok": true,
  "result": true,
  "description": "Webhook was set"
}
```

### 5.3 Verify Webhook
Check webhook status:
```
https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo
```

---

## Step 6: Test Your Bot

1. Open Telegram
2. Search for your bot by username
3. Send `/start`
4. You should see the main menu with all 10 modules!

---

## Troubleshooting

### Bot Not Responding

**Check Render Logs:**
1. Go to Render dashboard
2. Select `everythinginbot-web`
3. Click "Logs"
4. Look for errors

**Common Issues:**

1. **MongoDB Connection Failed**
   - Verify `MONGODB_URI` is correct
   - Check MongoDB Atlas network access (0.0.0.0/0)
   - Ensure database user has correct permissions

2. **Webhook Not Set**
   - Verify webhook URL is correct
   - Check `TELEGRAM_BOT_TOKEN` is set
   - Ensure web service is running

3. **Service Sleeping (Free Tier)**
   - Render free tier sleeps after 15 minutes of inactivity
   - First message after sleep takes ~30 seconds
   - Upgrade to paid tier for 24/7 uptime

### Viewing Logs

**Web Service Logs:**
```bash
# In Render dashboard
Services â†’ everythinginbot-web â†’ Logs
```

**Worker Logs:**
```bash
# In Render dashboard
Services â†’ everythinginbot-worker â†’ Logs
```

### Database Issues

**Check MongoDB Connection:**
1. Go to MongoDB Atlas
2. Click "Connect" â†’ "Connect with MongoDB Compass"
3. Use connection string to verify database exists

**Create Indexes Manually:**
If indexes weren't created automatically, run the commands from `schemas/collections.md` in MongoDB Compass.

---

## Monitoring

### Health Check
Visit: `https://everythinginbot-web.onrender.com/health`

Should return:
```json
{
  "status": "healthy",
  "service": "EverythingInBot",
  "version": "1.0.0"
}
```

### API Documentation
Visit: `https://everythinginbot-web.onrender.com/docs`

---

## Updating Your Bot

### Deploy Updates
```bash
# Make changes to code
git add .
git commit -m "Update: description of changes"
git push origin main
```

Render will automatically redeploy when you push to GitHub.

### Manual Redeploy
1. Go to Render dashboard
2. Select service
3. Click "Manual Deploy" â†’ "Deploy latest commit"

---

## Scaling

### Free Tier Limitations
- Web Service: Sleeps after 15 min inactivity
- Redis: 25MB storage
- Worker: Limited compute

### Upgrade Options
1. **Starter Plan** ($7/mo per service)
   - No sleeping
   - More resources
   - Better performance

2. **Redis Upgrade**
   - More storage for FSM states
   - Better performance

---

## Security Best Practices

1. **Keep API Keys Secret**
   - Never commit `.env` to Git
   - Use Render environment variables

2. **Use Strong Secrets**
   - Generate strong `JWT_SECRET_KEY`
   - Use unique `WEBHOOK_SECRET`

3. **Monitor Logs**
   - Check for suspicious activity
   - Monitor error rates

4. **Rate Limiting**
   - Implement rate limiting per user tier
   - Prevent abuse

---

## Next Steps

1. âœ… Complete remaining modules (M3-M10)
2. âœ… Implement actual AI integrations
3. âœ… Add payment processing
4. âœ… Build Telegram Mini App
5. âœ… Add admin panel
6. âœ… Implement analytics

---

## Support

- **Documentation**: See `README.md`
- **Issues**: GitHub Issues
- **MongoDB**: [MongoDB Atlas Docs](https://docs.atlas.mongodb.com/)
- **Render**: [Render Docs](https://render.com/docs)

---

**Congratulations! Your EverythingInBot is now live! ðŸŽ‰**
